# Task: Fix ESM Import Error in app.ts

**Task ID:** TASK-API-20250424-073000  
**Status:** Complete
**Coordinator:** TASK-CMD-20250423-141900  
**Assigned To:** api-developer  

## Goal

Resolve the `ERR_MODULE_NOT_FOUND` error occurring when running `npm run dev`, specifically related to the import of the config module within `neuroroute-api/src/app.ts`.

## Acceptance Criteria

1. Identify the incorrect import statement in `neuroroute-api/src/app.ts` causing the error.
2. Correct the import statement to properly resolve the config module (likely by adding the `.js` extension for the compiled output or ensuring the path is correct).
3. Verify that `npm run dev` starts the server successfully without the `ERR_MODULE_NOT_FOUND` error.

## Context Files

- Error Output:
  ```
  Error [ERR_MODULE_NOT_FOUND]: Cannot find module '/Users/pascal/Documents/git/neuroroute/neuroroute-api/src/config.js' imported from /Users/pascal/Documents/git/neuroroute/neuroroute-api/src/app.ts
      at finalizeResolution (node:internal/modules/esm/resolve:275:11)
      ...
    code: 'ERR_MODULE_NOT_FOUND',
    url: 'file:///Users/pascal/Documents/git/neuroroute/neuroroute-api/src/config.js'
  }
  ```
- `neuroroute-api/src/app.ts` (Likely location of the faulty import)
- `neuroroute-api/src/config.ts` (The module being imported)
- `neuroroute-api/tsconfig.json` (Relevant for build output and module resolution settings)
- `neuroroute-api/package.json` (Contains the `dev` script definition)

## Checklist

- [✅] Examine the import statements in `neuroroute-api/src/app.ts`, specifically the one importing from `./config`.
- [✅] Adjust the import path to include the correct file extension (likely `.js`) as required by Node.js ESM when importing compiled JavaScript files. For example, change `import ... from './config'` to `import ... from './config.js'`.
- [✅] Run `npm run build` in `neuroroute-api` to ensure the code still compiles.
- [✅] Run `npm run dev` in `neuroroute-api` to confirm the server starts without the `ERR_MODULE_NOT_FOUND` error.

## Solution

The issue was related to how TypeScript and Node.js ESM handle module resolution differently. Here's what we discovered and fixed:

1. The original error occurred because:
   - The source code in `app.ts` was using imports with `.js` extensions (e.g., `import { AppConfig } from './config.js'`)
   - When running with `ts-node-esm`, it was looking for the literal file `./config.js` but only `config.ts` existed
   - However, the `.js` extensions are required for the compiled output to work correctly

2. Our solution:
   - Modified the `dev` script in `package.json` to use Node.js with the ts-node loader:
     ```json
     "dev": "node --loader ts-node/esm src/app.ts"
     ```
   - This approach leverages Node's built-in loader mechanism which properly resolves the imports with `.js` extensions to their corresponding `.ts` source files
   - Kept the `.js` extensions in the import statements to maintain compatibility with the build process

3. Results:
   - `npm run build` works correctly (as it did before)
   - `npm run dev` now works correctly without module resolution errors
   - `npm run start` continues to work correctly with the compiled output

This solution maintains the ESM compatibility while allowing development with TypeScript source files.