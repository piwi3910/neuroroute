# Task: Debug Server Port Binding in app.ts

**Task ID:** TASK-API-20250424-075700  
**Status:** Pending  
**Coordinator:** TASK-CMD-20250423-141900  
**Assigned To:** api-developer  

## Goal

Identify and fix why the Fastify server is still running on port 8000 during development (`npm run dev`), despite the `.env` files specifying `PORT=3000` and the previous fix attempt in `app.ts`.

## Acceptance Criteria

1.  Add logging in `neuroroute-api/src/app.ts` to confirm the value of `fastify.config.PORT` and the actual port being passed to `fastify.listen()`.
2.  Analyze the logs to understand why the incorrect port is being used.
3.  Implement the necessary code changes to ensure the server consistently listens on `fastify.config.PORT`.
4.  Verify that `npm run dev` starts the server successfully and it is accessible on port 3000.

## Context Files

- `neuroroute-api/src/app.ts` (Main server file)
- `neuroroute-api/src/plugins/env.ts` (Environment loading plugin)
- `neuroroute-api/.env` (Should contain `PORT=3000`)
- `../.env` (Root .env file, confirmed to have `PORT=3000`)
- Previous `curl` results showing connection refused on 3000 but success on 8000.
- `grep` results showing no other obvious "8000" configurations.

## Checklist

- [‚è≥] Open `neuroroute-api/src/app.ts`.
- [‚è≥] In the server startup logic (e.g., within the `startServer` function or near the `fastify.listen()` call), add `fastify.log.info` statements to print:
    - The value of `fastify.config.PORT`.
    - The value being passed directly to the `port` option of `fastify.listen()`.
- [‚è≥] Stop the currently running dev server.
- [‚è≥] Run `npm run dev` in the `neuroroute-api` directory.
- [‚è≥] Examine the terminal output for the log messages to understand the port values.
- [‚è≥] Based on the logs, identify the source of the incorrect port (8000).
- [‚è≥] Modify `src/app.ts` to ensure `fastify.config.PORT` is correctly used for `fastify.listen()`.
- [‚è≥] Stop and restart the dev server.
- [‚è≥] Execute `curl -v http://localhost:3000/health` and verify a successful connection and 200 OK response.

üì£ Report back with the findings from the logging and confirmation that the server now runs on port 3000.